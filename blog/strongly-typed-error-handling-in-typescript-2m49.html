<!DOCTYPE html><html lang="en"><head><meta name="description" content="Mat Jones - Full Stack Software Engineer"/><link rel="shortcut icon" href="https://mjones.network/avatar_svg.png"/><link rel="icon" href="https://mjones.network/avatar_svg.png"/><meta property="og:title" content="mjones.network" data-rh="true"/><meta property="og:description" content="I&#x27;m a full-stack software engineer, passionate about online privacy, accessibility, and dark themes. 😎" data-rh="true"/><meta property="og:image" content="https://mjones.network/avatar.png" data-rh="true"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>mjones.network</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/dc2c323c109a22d97591.css" as="style"/><link rel="stylesheet" href="/_next/static/css/dc2c323c109a22d97591.css" data-n-g=""/><link rel="preload" href="/_next/static/css/865d965d91c4022c503c.css" as="style"/><link rel="stylesheet" href="/_next/static/css/865d965d91c4022c503c.css" data-n-g=""/><link rel="preload" href="/_next/static/css/677c9da28adb91d1f2f0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/677c9da28adb91d1f2f0.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-eec4aa9cad9b01b10bdb.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.17593bdcc9786a05bc11.js" as="script"/><link rel="preload" href="/_next/static/chunks/6278397b.345c06e4e71201848f4a.js" as="script"/><link rel="preload" href="/_next/static/chunks/1899967d.bbb99a9033920b4fc3df.js" as="script"/><link rel="preload" href="/_next/static/chunks/e528790cfab2d1a610238dc3edf348c46281d678.f124a28100027cef5782.js" as="script"/><link rel="preload" href="/_next/static/chunks/b54bf8666a19c68ed291d909bca66d7bd261c51d.07576abf9e5bfd60e066.js" as="script"/><link rel="preload" href="/_next/static/chunks/e82d01500e11e0131e78851aa17fd9f5e63d6c88.9721a3d740421889fdc9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-227167814087f23f0f50.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-3e965507edcacefbaa18.js" as="script"/></head><body><div id="__next"><div class="main-layout_mainLayout__1S1wN bp3-dark"><div class="bp3-navbar bp3-fixed-top main-nav_mainNav__2jevg"><div class="bp3-navbar-group bp3-align-left main-nav_mainNav__left__2jcQ_"><div class="bp3-navbar-heading main-nav_mainNav__left__brand__2SqSx"><a role="button" aria-label="Home" href="/" class="bp3-button bp3-minimal" tabindex="0"><span class="bp3-button-text"><div class="main-nav_mainNav__left__brand__container__1SKWr"><svg width="32" height="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 264 280"><defs><path d="M12 160c0 66.274 53.726 120 120 120s120-53.726 120-120h12V0H0v160h12z" id="avatar_svg__c"></path><path d="M124 144.611V163h4c39.765 0 72 32.235 72 72v9H0v-9c0-39.765 32.235-72 72-72h4v-18.389c-17.237-8.189-29.628-24.924-31.695-44.73C38.48 99.058 34 94.052 34 88V74c0-5.946 4.325-10.882 10-11.834V56c0-30.928 25.072-56 56-56s56 25.072 56 56v6.166c5.675.952 10 5.888 10 11.834v14c0 6.052-4.48 11.058-10.305 11.881-2.067 19.806-14.458 36.541-31.695 44.73z" id="avatar_svg__e"></path><circle id="avatar_svg__a" cx="120" cy="120" r="120"></circle></defs><g fill="none" fill-rule="evenodd"><g transform="translate(12 40)"><mask id="avatar_svg__b" fill="#fff"><use xlink:href="#avatar_svg__a"></use></mask><use fill="#E6E6E6" xlink:href="#avatar_svg__a"></use><g mask="url(#avatar_svg__b)" fill="#65C9FF"><path d="M0 0h240v240H0z"></path></g></g><mask id="avatar_svg__d" fill="#fff"><use xlink:href="#avatar_svg__c"></use></mask><g mask="url(#avatar_svg__d)"><g transform="translate(32 36)"><mask id="avatar_svg__f" fill="#fff"><use xlink:href="#avatar_svg__e"></use></mask><use fill="#D0C6AC" xlink:href="#avatar_svg__e"></use><g mask="url(#avatar_svg__f)" fill="#EDB98A"><path d="M0 0h264v280H0z"></path></g><path d="M156 79v23c0 30.928-25.072 56-56 56s-56-25.072-56-56V79v15c0 30.928 25.072 56 56 56s56-25.072 56-56V79z" fill-opacity="0.1" fill="#000" mask="url(#avatar_svg__f)"></path></g><g transform="translate(0 170)"><defs><path d="M108 13.07c-17.919 2.006-31.72 7.482-31.996 21.575C50.146 45.568 32 71.165 32 100.999V110h200v-9c0-29.835-18.146-55.432-44.004-66.355-.276-14.093-14.077-19.57-31.996-21.574V32c0 13.255-10.745 24-24 24s-24-10.745-24-24V13.07z" id="avatar_svg__g"></path></defs><mask id="avatar_svg__h" fill="#fff"><use xlink:href="#avatar_svg__g"></use></mask><use fill="#B7C1DB" xlink:href="#avatar_svg__g"></use><g mask="url(#avatar_svg__h)" fill="#262E33"><path d="M0 0h264v110H0z"></path></g><path d="M102 61.74V110h-7V58.15a64.54 64.54 0 007 3.59zm67-3.59V98.5a3.5 3.5 0 11-7 0V61.74a64.54 64.54 0 007-3.59z" fill="#F4F4F4" mask="url(#avatar_svg__h)"></path><path d="M90.96 12.724C75.91 15.571 65.5 21.243 65.5 32.308 65.5 52.02 98.538 68 132 68s66.5-15.98 66.5-35.692c0-11.065-10.41-16.737-25.46-19.584 9.085 3.35 14.96 8.982 14.96 18.353C188 51.469 160.179 68 132 68S76 51.469 76 31.077c0-9.37 5.875-15.003 14.96-18.353z" fill-opacity="0.16" fill="#000" mask="url(#avatar_svg__h)"></path></g><g fill="#000"><rect x="42" y="18" width="24" height="6" rx="3" transform="translate(78 134)" fill-opacity="0.7"></rect><path d="M120 130c0 4.418 5.373 8 12 8s12-3.582 12-8" fill-opacity="0.16"></path><g transform="translate(76 90)" fill-opacity="0.6"><circle cx="30" cy="22" r="6"></circle><circle cx="82" cy="22" r="6"></circle></g><g fill-rule="nonzero" fill-opacity="0.6"><path d="M91.63 99.159c3.915-5.51 14.648-8.598 23.893-6.328a2 2 0 00.954-3.884c-10.737-2.637-23.165.94-28.107 7.894a2 2 0 003.26 2.318zM172.37 99.159c-3.915-5.51-14.648-8.598-23.893-6.328a2 2 0 01-.954-3.884c10.737-2.637 23.165.94 28.108 7.894a2 2 0 01-3.26 2.318z"></path></g></g><defs><path id="avatar_svg__i" d="M0 0h264v280H0z"></path><path d="M94.252 52.022c.123-.054-.182-.075-.916-.062.892-.002 1.197.019.916.062m-8.135-15.72c-.002-.02.017.15 0 0m107.648 34.464c-.264-3.317-.732-6.614-1.518-9.855-.625-2.576-1.478-5.033-2.487-7.491-.61-1.485-2.032-3.524-2.2-5.126-.165-1.577 1.067-3.325 1.33-5.162a15.981 15.981 0 00-.156-5.438c-.833-4.023-3.594-7.764-7.857-8.813-.952-.234-2.964.055-3.636-.5-.771-.635-1.308-2.8-2.006-3.669-1.99-2.476-5.095-4.07-8.37-3.514-2.41.409-1.026.907-2.833-.512-1.005-.788-1.756-1.993-2.732-2.847-1.467-1.283-3.15-2.38-4.892-3.282-4.557-2.358-9.754-4.072-14.844-4.908-9.285-1.524-19.195-.195-28.195 2.22-4.479 1.201-8.987 2.726-13.147 4.743-1.783.864-2.813 1.582-4.673 1.808-2.928.357-5.409.339-8.183 1.581-8.536 3.822-12.381 12.689-9.06 21.174a14.64 14.64 0 002.82 4.584c1.521 1.68 2.072 1.35.762 3.282a52.787 52.787 0 00-4.955 9.172c-3.529 8.402-4.12 17.864-3.89 26.824.081 3.137.216 6.313.71 9.42.214 1.344.274 3.872 1.282 4.87.512.506 1.241.788 1.969.587 1.71-.474 1.121-1.735 1.161-2.906.2-5.884-.07-11.089 1.33-16.902 1.033-4.294 2.755-8.195 4.988-12.035 2.838-4.884 5.903-9.173 9.807-13.355.917-.984 1.118-1.4 2.349-1.472.932-.054 2.295.584 3.2.805 1.999.487 4 .968 6.034 1.296 3.74.603 7.444.644 11.217.525 7.426-.232 14.885-.753 22.085-2.623 4.782-1.242 9.022-3.47 13.602-5.105.082-.029 1.23-.847 1.43-.814.282.047 1.978 1.826 2.264 2.05 2.226 1.746 4.667 2.479 7.07 3.83 2.964 1.667.094-.718 1.728 1.359.477.605.72 1.726 1.103 2.411a18.08 18.08 0 004.93 5.624c1.956 1.47 4.894 2.18 5.891 4.095.769 1.477 1.028 3.484 1.648 5.06 1.628 4.136 3.777 7.992 5.926 11.887 1.732 3.14 3.625 5.881 3.818 9.468.067 1.248-1.121 8.737 1.773 6.46.429-.338 1.353-4.156 1.543-4.804.772-2.633 1.046-5.381 1.395-8.086.694-5.38.923-10.498.47-15.916" id="avatar_svg__k"></path></defs><mask id="avatar_svg__j" fill="#fff"><use xlink:href="#avatar_svg__i"></use></mask><g mask="url(#avatar_svg__j)"><g transform="translate(-1)"><mask id="avatar_svg__l" fill="#fff"><use xlink:href="#avatar_svg__k"></use></mask><use fill="#28354B" xlink:href="#avatar_svg__k"></use><g mask="url(#avatar_svg__l)" fill="#4A312C"><path d="M0 0h264v280H0z"></path></g><g transform="translate(62 85)"><defs><filter x="-.8%" y="-2.4%" width="101.5%" height="109.8%" filterUnits="objectBoundingBox" id="avatar_svg__m"><feOffset dy="2" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0" in="shadowOffsetOuter1" result="shadowMatrixOuter1"></feColorMatrix><feMerge><feMergeNode in="shadowMatrixOuter1"></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter></defs><g filter="url(#avatar_svg__m)" transform="translate(8 8)" fill="#D6EAF2"><path d="M46.25 7.275c2.37.022 3.492.417 3.896 2.89.41 2.506.011 5.322-.46 7.79-.721 3.768-1.92 7.46-4.708 10.214-1.47 1.45-3.261 2.606-5.167 3.395-1.012.42-2.081.722-3.15.952-.312.067-2.979.434-1.343.248-3.817.435-7.958.418-11.146-2.012-3.532-2.692-5.952-6.952-7.015-11.196-.623-2.483-1.93-8.422.459-10.407 2.737-2.274 28.633-1.874 28.633-1.874zM22.217.49c-5.44.188-9.071 1.144-11.755 6.58-4.917 9.96 3.5 24.899 12.89 28.97 10.976 4.76 23.24-.508 29.043-10.034 3.073-5.044 4.626-12.683 4.526-18.502C56.795.077 51.607-.13 45.51.034L22.218.49zM79.68 7.273c-2.371.022-3.492.416-3.896 2.89-.41 2.505-.012 5.322.46 7.79.72 3.767 1.919 7.459 4.708 10.213 1.47 1.45 3.261 2.606 5.167 3.396 1.012.419 2.08.722 3.15.951.312.067 2.978.435 1.343.248 3.817.436 7.958.418 11.145-2.011 3.533-2.692 5.952-6.952 7.016-11.196.623-2.483 1.93-8.422-.46-10.407-2.737-2.275-28.632-1.874-28.632-1.874zM103.713.488c5.44.187 9.071 1.144 11.754 6.579 4.918 9.96-3.5 24.9-12.889 28.97-10.977 4.76-23.24-.508-29.043-10.033C70.46 20.96 68.907 13.32 69.007 7.5 69.135.074 74.323-.132 80.42.031l23.29.457z"></path><path d="M13.197 4.927c-3.412.191-7.31.237-10.507 1.712-3.385 1.562-3.908 5.1.36 5.587 1.92.22 3.845-.143 5.737-.481 1.55-.277 3.655-.187 5.12-.78 2.729-1.103 2.553-6.225-.71-6.038M112.735 4.927c3.412.191 7.31.237 10.507 1.712 3.384 1.562 3.907 5.1-.36 5.587-1.921.22-3.845-.143-5.738-.481-1.55-.277-3.654-.187-5.119-.78-2.73-1.103-2.554-6.225.71-6.038M73.11 7.013c-1.947-2.3-7.019-3.628-10.219-3.628-3.2 0-8.123 1.328-10.069 3.628-.981 1.16-1.015 2.711.686 3.438 2.118.906 4.01-.737 5.705-1.596 2.168-1.098 5.499-.978 7.506 0 1.708.833 3.586 2.502 5.704 1.596 1.701-.727 1.668-2.279.686-3.438"></path></g></g></g></g></g></g></svg><span class="main-nav_mainNav__left__brand__container__text__EScH5">mjones.network</span></div></span></a></div><div class="bp3-navbar-divider"></div><div class="main-nav_mainNav__left__navLinks__2WRVf"><a role="button" aria-label="About" class="bp3-button bp3-minimal nav-link-buttons_navLinkButtons__button__UwOsL main-nav_mainNav__left__navLinks__links__19Sb2" href="/about" tabindex="0"><span class="bp3-button-text">About</span></a><a role="button" aria-label="Blog" class="bp3-button bp3-active bp3-minimal nav-link-buttons_navLinkButtons__button__UwOsL main-nav_mainNav__left__navLinks__links__19Sb2" href="/blog" tabindex="0"><span class="bp3-button-text">Blog</span></a><a role="button" aria-label="Contact Me" class="bp3-button bp3-minimal nav-link-buttons_navLinkButtons__button__UwOsL main-nav_mainNav__left__navLinks__links__19Sb2" href="/contact" tabindex="0"><span class="bp3-button-text">Contact Me</span></a><span class="bp3-popover-wrapper main-nav_mainNav__left__navLinks__menu__2e9En"><span class="bp3-popover-target"><button type="button" class="bp3-button"><span icon="menu" class="bp3-icon bp3-icon-menu"><svg data-icon="menu" width="16" height="16" viewBox="0 0 16 16"><desc>menu</desc><path d="M1 4h14c.55 0 1-.45 1-1s-.45-1-1-1H1c-.55 0-1 .45-1 1s.45 1 1 1zm14 8H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1zm0-5H1c-.55 0-1 .45-1 1s.45 1 1 1h14c.55 0 1-.45 1-1s-.45-1-1-1z" fill-rule="evenodd"></path></svg></span></button></span></span></div></div><div class="bp3-navbar-group bp3-align-right"><label class="bp3-control bp3-switch bp3-align-right main-nav_mainNav__themeSwitcher__3V8yT"><input type="checkbox" checked=""/><span class="bp3-control-indicator"><div class="bp3-control-indicator-child"><div class="bp3-switch-inner-text">Dark</div></div><div class="bp3-control-indicator-child"><div class="bp3-switch-inner-text">Light</div></div></span>Theme</label></div></div><div class="main-layout_mainLayout__content__1Jcm6"><div class="main-layout_mainLayout__content__inner__39EEF"><div class="bp3-card bp3-elevation-0 _slug__blogPost__3iNfD"><div class="_slug__blogPost__image__33lx5"><img src="https://res.cloudinary.com/practicaldev/image/fetch/s--iaDSv-7K--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/i/fi12u6nldkfm4kesn07z.png" alt="TypeScript is a great language. TypeScript takes JavaScript and makes it actually good. If there’s on..." width="100%" height="auto"/></div><div class="_slug__blogPost__title__5jwf0"><h1 class="bp3-heading">Strongly Typed Error Handling in TypeScript</h1><div><span class="bp3-tag _slug__blogPost__title__meta__tag__3h5KD"><span icon="calendar" class="bp3-icon bp3-icon-calendar"><svg data-icon="calendar" width="16" height="16" viewBox="0 0 16 16"><desc>calendar</desc><path d="M11 3c.6 0 1-.5 1-1V1c0-.6-.4-1-1-1s-1 .4-1 1v1c0 .5.4 1 1 1zm3-2h-1v1c0 1.1-.9 2-2 2s-2-.9-2-2V1H6v1c0 1.1-.9 2-2 2s-2-.9-2-2V1H1c-.6 0-1 .5-1 1v12c0 .6.4 1 1 1h13c.6 0 1-.4 1-1V2c0-.6-.5-1-1-1zM5 13H2v-3h3v3zm0-4H2V6h3v3zm4 4H6v-3h3v3zm0-4H6V6h3v3zm4 4h-3v-3h3v3zm0-4h-3V6h3v3zM4 3c.6 0 1-.5 1-1V1c0-.6-.4-1-1-1S3 .4 3 1v1c0 .5.4 1 1 1z" fill-rule="evenodd"></path></svg></span><span class="bp3-text-overflow-ellipsis bp3-fill">Jan 16</span></span><a class="_slug__blogPost__title__meta__tag__3h5KD" href="https://dev.to/matjones/strongly-typed-error-handling-in-typescript-2m49" target="_blank" rel="noopener noreferrer"><span class="bp3-tag"><span icon="comment" class="bp3-icon bp3-icon-comment"><svg data-icon="comment" width="16" height="16" viewBox="0 0 16 16"><desc>comment</desc><path d="M14 1H1c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h2v3a1.003 1.003 0 001.71.71L8.41 12H14c.55 0 1-.45 1-1V2c0-.55-.45-1-1-1zM3.5 8C2.67 8 2 7.33 2 6.5S2.67 5 3.5 5 5 5.67 5 6.5 4.33 8 3.5 8zm4 0C6.67 8 6 7.33 6 6.5S6.67 5 7.5 5 9 5.67 9 6.5 8.33 8 7.5 8zm4 0c-.83 0-1.5-.67-1.5-1.5S10.67 5 11.5 5s1.5.67 1.5 1.5S12.33 8 11.5 8z" fill-rule="evenodd"></path></svg></span><span class="bp3-text-overflow-ellipsis bp3-fill">0</span></span></a><a class="_slug__blogPost__title__meta__tag__3h5KD" href="https://dev.to/matjones/strongly-typed-error-handling-in-typescript-2m49" target="_blank" rel="noopener noreferrer"><span class="bp3-tag"><span icon="thumbs-up" class="bp3-icon bp3-icon-thumbs-up"><svg data-icon="thumbs-up" width="16" height="16" viewBox="0 0 16 16"><desc>thumbs-up</desc><path d="M15.99 9.62c-.08-.58-.73-.96-1.43-1.05-.15-.02-.32-.04-.49-.05.06-.01.11-.01.16-.02.71-.08 1.23-.47 1.15-1.05-.08-.58-.73-.96-1.43-1.05-.34-.04-.72-.07-1.13-.09h-.01c-.24-.01-.49-.02-.75-.02-.48-.02-1.11-.04-1.59-.08-.36-.03-.41-.28-.37-.53.35-.9.54-1.91.5-2.91-.04-.85-.6-1.68-1.41-1.77-.67-.07-1.16.39-.99.98C8.76 3.91 6.13 6.2 4 7.49v6c1.66 1.03 4.35 1.56 7.48 1.5.19 0 .39-.01.62-.02h.09c.22-.01.46-.03.73-.05.71-.06 1.54-.51 1.5-1.09-.03-.51-.4-.79-.87-.93.27-.02.54-.04.79-.06.71-.06 1.24-.45 1.17-1.04-.06-.58-.7-.97-1.41-1.07-.02 0-.05-.01-.07-.01.29-.02.57-.03.81-.05.71-.03 1.23-.47 1.15-1.05zM2 7H0v7h2c.55 0 1-.45 1-1V8c0-.56-.45-1-1-1z" fill-rule="evenodd"></path></svg></span><span class="bp3-text-overflow-ellipsis bp3-fill">1</span></span></a></div></div><div class="_slug__blogPost__body__QWfTp"><div class="bp3-running-text"><p>TypeScript is a great language. TypeScript takes JavaScript and makes it <em>actually good.</em> If there’s one glaring weakness, it’s the <a href="https://github.com/Microsoft/TypeScript/issues/8677">inability to use strongly typed catch blocks</a>. However, this is mostly due to a design flaw in the JavaScript language; in JavaScript, you can <code>throw</code> <em>anything</em>, not just <code>Error</code> types.</p>

<h1>
  <a name="a-note-before-we-start" href="#a-note-before-we-start" class="anchor">
  </a>
  A Note Before We Start
</h1>

<p>While I used some packages from the <code>AndcultureCode</code> GitHub organization, it just made this proof-of-concept easier to demonstrate. This same pattern could be easily applied without using any of these packages, and could be tied in with whatever existing infrastructure you have set up.</p>

<h1>
  <a name="justification" href="#justification" class="anchor">
  </a>
  Justification
</h1>

<p>Consider the following, completely valid TypeScript code:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="k">try</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="na">x</span><span class="p">:</span> <span class="kr">number</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="k">throw</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">e</span><span class="p">);</span> <span class="c1">// "number"</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="c1">// 7</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>You can quite literally throw anything.</figcaption></figure>





<p>It’s easy to see why this can be a problem.  One use-case where this is less than ideal is consuming a web API from TypeScript. It’s quite common for non-success HTTP status codes (500 Internal Server Error, 404 Not Found, etc.) to be thrown as an error by API consumer code.</p>

<h1>
  <a name="usage" href="#usage" class="anchor">
  </a>
  Usage
</h1>

<p>Let’s consider an example using some utilities from <a href="https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core">AndcultureCode.JavaScript.Core</a> and <a href="https://github.com/AndcultureCode/AndcultureCode.JavaScript.React">AndcultureCode.JavaScript.React</a>, which wrap up API responses and errors in <code>ResultRecord</code> and <code>ResultErrorRecord</code> <a href="https://github.com/immutable-js/immutable-js">Immutable.js</a> <code>Record</code> types.<br>
</p>

<div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="cm">/*
Let's say the API returns a 500 error, with an error
result JSON object:
-- Status: 500
-- Data:
{
  "errors": [
    {
      "key": "UserAlreadyExists",
      "message": "User with specified email already exists.",
      "type": "Validation"
    }
  ]
  "resultObject": undefined
}
*/</span>

<span class="kd">const</span> <span class="nx">createUserApi</span> <span class="o">=</span> <span class="nx">ServiceFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">UserRecord</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/api/users/</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">createUser</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">UserRecord</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">UserRecord</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">createUserApi</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">resultObject</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// if the thing that was thrown is a ResultRecord, show a toast message for each error</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="k">instanceof</span> <span class="nx">ResultRecord</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="na">error</span><span class="p">:</span> <span class="nx">ResultErrorRecord</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
      <span class="k">return</span> <span class="kc">undefined</span><span class="p">.</span>
    <span class="p">}</span>

    <span class="c1">// otherwise, it could be anything, so just show a generic error message</span>
    <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">There was an issue creating the user.</span><span class="dl">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="c1">// maybe we need to turn off a loading indicator here</span>
  <span class="p">}</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>



<p>You can see in this example that handling errors natively in TypeScript is… quite sloppy. The <a href="https://en.wikipedia.org/wiki/Monad_%28functional_programming%29#An_example:_Maybe">“maybe monad”</a> common pattern to more generically handle errors and control flow. Basically, what we want to do is create an abstraction that can strongly type thrown errors to a specified type that you know is likely to be thrown. In our case, we want to be able to handle errors from a strongly typed <code>ResultRecord</code> with <code>ResultErrorRecord</code>s inside it.</p>

<p>What if we could take the example above, and represent the same logic but with less code and strong typing in the catch block? In the following example, one of <code>result</code> or <code>error</code> will be non-null, but not both.<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="cm">/*
Let's say the API returns the same response as before.
result JSON object:
-- Status: 500
-- Data:
{
  "errors": [
    {
      "key": "UserAlreadyExists",
      "message": "User with specified email already exists.",
      "type": "Validation"
    }
  ]
  "resultObject": undefined
}
*/</span>

<span class="kd">const</span> <span class="nx">createUserApi</span> <span class="o">=</span> <span class="nx">ServiceFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">UserRecord</span><span class="p">,</span> <span class="dl">"</span><span class="s2">/api/users/</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">createUser</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">user</span><span class="p">:</span> <span class="nx">UserRecord</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">UserRecord</span> <span class="o">|</span> <span class="kc">undefined</span><span class="o">&gt;</span> <span class="o">=&gt;</span>
  <span class="k">await</span> <span class="nx">Do</span><span class="p">.</span><span class="k">try</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">createUserApi</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">resultObject</span><span class="p">;</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">result</span><span class="p">?:</span> <span class="nx">ResultRecord</span><span class="o">&lt;</span><span class="nx">UserRecord</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">error</span><span class="p">?:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// if result is not null, it will have errors; show toast errors</span>
    <span class="nx">result</span><span class="p">?.</span><span class="nx">errors</span><span class="p">?.</span><span class="nx">forEach</span><span class="p">((</span><span class="na">e</span><span class="p">:</span> <span class="nx">ResultErrorRecord</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">));</span>
    <span class="c1">// otherwise, unknown error; show a generic toast message</span>
    <span class="nx">error</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">There was an issue creating the user.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}).</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// maybe we need to turn off a loading indicator here</span>
  <span class="p">}).</span><span class="nx">getAwaiter</span><span class="p">();</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>Automatic typecasting? Nice 😎</figcaption></figure>





<p>This pattern gives us a more functional approach to error handling, gives us <strong>strongly typed</strong> errors, and works really, really nicely when used in combination with <a href="https://reactjs.org/docs/hooks-intro.html">React hooks</a>. Let’s take a look at a simple React example using some infrastructure from <a href="https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core">AndcultureCode.JavaScript.Core</a>, <a href="https://github.com/AndcultureCode/AndcultureCode.JavaScript.React">AndcultureCode.JavaScript.React</a> and <a href="https://github.com/AndcultureCode/AndcultureCode.JavaScript.React.Components">AndcultureCode.JavaScript.React.Components</a>:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">const</span> <span class="nx">LoginForm</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">FunctionComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="na">create</span><span class="p">:</span> <span class="nx">createUserApi</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">UserService</span><span class="p">.</span><span class="nx">useCreate</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">history</span> <span class="o">=</span> <span class="nx">useHistory</span><span class="p">();</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">user</span><span class="p">,</span> <span class="nx">setUser</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="k">new</span> <span class="nx">UserRecord</span><span class="p">());</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">errors</span><span class="p">,</span> <span class="nx">setErrors</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="o">&lt;</span><span class="nb">Array</span><span class="o">&lt;</span><span class="nx">ResultErrorRecord</span><span class="o">&gt;&gt;</span><span class="p">([]);</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">loading</span><span class="p">,</span> <span class="nx">setLoading</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">createUser</span> <span class="o">=</span> <span class="nx">useCallback</span><span class="p">(</span>
    <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">await</span> <span class="nx">Do</span><span class="p">.</span><span class="k">try</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">setErrors</span><span class="p">([]);</span>
      <span class="nx">setLoading</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">createUserApi</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
      <span class="nx">history</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">RouteUtils</span><span class="p">.</span><span class="nx">getUrl</span><span class="p">(</span><span class="nx">siteMap</span><span class="p">.</span><span class="nx">myProfile</span><span class="p">,</span> <span class="p">{</span> <span class="na">userId</span><span class="p">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">resultObject</span><span class="o">!</span><span class="p">.</span><span class="nx">id</span><span class="o">!</span> <span class="p">}));</span>
    <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">result</span><span class="p">?:</span> <span class="nx">ResultRecord</span><span class="o">&lt;</span><span class="nx">UserRecord</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">error</span><span class="p">?:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">setErrors</span><span class="p">(</span><span class="nx">result</span><span class="p">?.</span><span class="nx">errors</span> <span class="o">??</span> <span class="p">[]);</span>
      <span class="nx">error</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">toast</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">There was an issue signing up.</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}).</span><span class="k">finally</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setLoading</span><span class="p">(</span><span class="kc">false</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">getAwaiter</span><span class="p">(),</span>
    <span class="p">[</span><span class="nx">createUserApi</span><span class="p">,</span> <span class="nx">user</span><span class="p">]</span>
  <span class="p">);</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">c-login-form</span><span class="dl">"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">InputFormField</span>
        <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">loading</span><span class="p">}</span>
        <span class="nx">label</span><span class="o">=</span><span class="dl">"</span><span class="s2">Email</span><span class="dl">"</span>
        <span class="nx">required</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span>
        <span class="kd">type</span><span class="o">=</span><span class="p">{</span><span class="nx">InputTypes</span><span class="p">.</span><span class="nx">Email</span><span class="p">}</span>
        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">}</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="kd">with</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
        <span class="nx">errors</span><span class="o">=</span><span class="p">{</span><span class="nx">errors</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">SignUp.Email</span><span class="dl">"</span><span class="p">)}</span>
      <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">InputFormField</span>
        <span class="nx">disabled</span><span class="o">=</span><span class="p">{</span><span class="nx">loading</span><span class="p">}</span>
        <span class="nx">label</span><span class="o">=</span><span class="dl">"</span><span class="s2">Password</span><span class="dl">"</span>
        <span class="nx">required</span><span class="o">=</span><span class="p">{</span><span class="kc">true</span><span class="p">}</span>
        <span class="kd">type</span><span class="o">=</span><span class="p">{</span><span class="nx">InputTypes</span><span class="p">.</span><span class="nx">Password</span><span class="p">}</span>
        <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">}</span>
        <span class="nx">onChange</span><span class="o">=</span><span class="p">{</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">setUser</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="kd">with</span><span class="p">({</span> <span class="na">password</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="p">})}</span>
        <span class="nx">errors</span><span class="o">=</span><span class="p">{</span><span class="nx">errors</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">SignUp.Password</span><span class="dl">"</span><span class="p">)}</span>
      <span class="sr">/</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">Button</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">createUser</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Sign</span> <span class="nx">Up</span><span class="o">&lt;</span><span class="sr">/Button</span><span class="err">&gt;
</span>      <span class="p">{</span><span class="nx">loading</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">&lt;</span><span class="nx">LoadingSpinner</span><span class="o">/&gt;</span><span class="p">)}</span>
    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>Strong typing is better than weak typing.</figcaption></figure>





<p>Clean, concise, and strongly typed error handling in just 46 lines of code, including the UI.</p>

<h1>
  <a name="implementation" href="#implementation" class="anchor">
  </a>
  Implementation
</h1>

<p>So how does this fancy-schmancy <code>Do.try</code> work under the hood? By adding an abstraction on top of regular old <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>s. Let’s break it down.</p>

<p>First, let’s define some utility types we’re going to need:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="cm">/**
 * Represents an asynchronous method reference.
 */</span>
<span class="kd">type</span> <span class="nx">AsyncWorkload</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">;</span>

<span class="cm">/**
 * Handler for a typed error ResultRecord, or any type if a Javascript error occurred.
 */</span>
<span class="kd">type</span> <span class="nx">CatchResultHandler</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">(</span><span class="nx">result</span><span class="p">?:</span> <span class="nx">ResultRecord</span><span class="o">&lt;</span><span class="nx">T</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">error</span><span class="p">?:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>

<span class="cm">/**
 * Handler for Do.try().finally(); Runs whether an error occurred or not.
 */</span>
<span class="kd">type</span> <span class="nx">FinallyHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="k">void</span><span class="p">;</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>Strongly typed handlers for strongly typed errors.</figcaption></figure>





<p>Next, let’s take a look at our constructor:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">class</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span> <span class="o">=</span> <span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">private</span> <span class="na">promise</span><span class="p">:</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TReturnVal</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="k">private</span> <span class="kd">constructor</span><span class="p">(</span><span class="na">workload</span><span class="p">:</span> <span class="nx">AsyncWorkload</span><span class="o">&lt;</span><span class="nx">TReturnVal</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">promise</span> <span class="o">=</span> <span class="nx">workload</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>Private constructor? 🤔</figcaption></figure>





<p>That <code>private constructor</code> is no mistake. You’ll notice in the previous snippets, usage of this pattern starts with <code>Do.try</code>; that’s because <code>try</code> is a static factory method that returns an instance of <code>Do</code>. The <code>private constructor</code> can only be called internally to the class, by the <code>try</code> method. The implementation of <code>try</code> is very straightforward:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">class</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span> <span class="o">=</span> <span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">...</span> 
  <span class="k">public</span> <span class="k">static</span> <span class="k">try</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span> <span class="o">=</span> <span class="k">void</span><span class="o">&gt;</span><span class="p">(</span>
    <span class="na">workload</span><span class="p">:</span> <span class="nx">AsyncWorkload</span><span class="o">&lt;</span><span class="nx">TReturnVal</span><span class="o">&gt;</span>
  <span class="p">):</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">workload</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>You’ll never know unless you… try.</figcaption></figure>





<p>The <code>finally</code> method is just as straightforward, with one important caveat:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">class</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span> <span class="o">=</span> <span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">public</span> <span class="k">finally</span><span class="p">(</span>
    <span class="na">finallyHandler</span><span class="p">:</span> <span class="nx">FinallyHandler</span>
  <span class="p">):</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">promise</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="p">.</span><span class="k">finally</span><span class="p">(</span><span class="nx">finallyHandler</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>Pay special attention to the return value.</figcaption></figure>





<p>Notice the return value, <code>return this;</code> This allows for method chaining, i.e. <code>Do.try(workload).catch(catchHandler).finally(finallyHandler);</code> In this code, <code>catch</code> and <code>finally</code> are both called on the same instance of <code>Do</code> which is returned from <code>Do.try</code>.</p>

<p>There’s also a <code>getAwaiter</code> method, which allows us to <code>await</code> for the result. All we need to do is return the internal promise.<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">class</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span> <span class="o">=</span> <span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">public</span> <span class="k">async</span> <span class="nx">getAwaiter</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TReturnVal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>This just allows us to await the result of the entire method chain.</figcaption></figure>





<p>Now let’s get to the interesting part; the <code>catch</code> method. Inside the catch method, we’re going to <a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#user-defined-type-guards">type guard</a> the thrown object; if the thrown object is a <code>ResultRecord</code> instance, we cast it as such and pass it as the catch handler’s first argument; otherwise, it’s some unknown error, so we pass it as the catch handler’s second argument. We also need to cast the promise back to a <code>Promise&lt;TReturnVal&gt;</code> because of the return type of <code>Promise.catch</code>, but the promise is still a valid <code>Promise&lt;TReturnVal&gt;</code>.<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kd">class</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span> <span class="o">=</span> <span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">catch</span><span class="p">(</span>
    <span class="na">errorHandler</span><span class="p">:</span> <span class="nx">CatchResultHandler</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="o">&gt;</span>
  <span class="p">):</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">promise</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">promise</span><span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="na">err</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// check if thrown object is a ResultRecord</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="k">instanceof</span> <span class="nx">ResultRecord</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// pass the ResultRecord as the first parameter</span>
        <span class="nx">errorHandler</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="c1">// otherwise, pass the generic error as the second parameter</span>
      <span class="nx">errorHandler</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">})</span> <span class="k">as</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">TReturnVal</span><span class="o">&gt;</span><span class="p">;</span>

    <span class="c1">// notice again, we are returning this to allow method chaining</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>We just need to cast the promise back to a `Promise` because of the return type of `Promise.catch`, but rest assured, the promise is still a valid `Promise`.</figcaption></figure>





<p>And there you have a basic implementation of a “maybe monad”. While the implementation here is an opinionated one, offering strongly typed error handling for <code>ResultRecord</code> errors, you could easily implement the same thing for virtually any type you want to use to wrap up your errors, just as long as you’re able to implement a type guard for it.</p>

<h1>
  <a name="taking-it-further" href="#taking-it-further" class="anchor">
  </a>
  Taking It Further
</h1>

<p>I think strongly typed error handling speaks enough for itself, but we can take it even further. This pattern enables an extremely powerful utility, and I think it’s the strongest argument for using it: <a href="https://en.wikipedia.org/wiki/Default_(computer_science)#In_application_software"><em>default behavior</em></a>. We can extend our <code>Do</code> class to have a global configuration, allowing us to define <em>default behavior which is applied to every instance of <code>Do</code> across the entire application</em>.</p>

<p>All we need to do is add a static configuration mechanism, and implement a check for our configuration inside the constructor:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="kr">interface</span> <span class="nx">DoTryConfig</span> <span class="p">{</span>
  <span class="cm">/**
   * A default handler that will always run on error, if configured,
   * even if a `catch()` does not exist in the call chain.
   * This is useful for adding default error handling in the
   * development environment, such as `console.error(err)`.
   */</span>
  <span class="nl">defaultErrorHandler</span><span class="p">?:</span> <span class="nx">CatchResultHandler</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nx">Do</span><span class="o">&lt;</span><span class="nx">TResourceType</span><span class="p">,</span> <span class="nx">TReturnVal</span> <span class="o">=</span> <span class="k">void</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="k">private</span> <span class="k">static</span> <span class="na">config</span><span class="p">:</span> <span class="nx">DoTryConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">defaultErrorHandler</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">private</span> <span class="kd">constructor</span><span class="p">(</span><span class="na">workload</span><span class="p">:</span> <span class="nx">AsyncWorkload</span><span class="o">&lt;</span><span class="nx">TReturnVal</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">promise</span> <span class="o">=</span> <span class="nx">workload</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="na">err</span><span class="p">:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// check for defaultErrorHandler from config</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="k">instanceof</span> <span class="nx">ResultRecord</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Do</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">defaultErrorHandler</span><span class="p">?.(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">);</span>
        <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> <span class="c1">// rethrow so it doesn't interrupt call chain</span>
      <span class="p">}</span>

      <span class="nx">Do</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">defaultErrorHandler</span><span class="p">?.(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> <span class="c1">// rethrow so it doesn't interrupt call chain</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="cm">/**
   * Sets the global configuration object for class {Do}
   * @param config the {DoTryConfig} object to set
   */</span>
  <span class="k">public</span> <span class="k">static</span> <span class="nx">configure</span><span class="p">(</span><span class="na">config</span><span class="p">:</span> <span class="nx">DoTryConfig</span><span class="p">):</span> <span class="k">void</span> <span class="p">{</span>
    <span class="nx">Do</span><span class="p">.</span><span class="nx">config</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>Default behavior is epic.</figcaption></figure>





<p>So what does it look like to apply default behavior? Let’s contrive an example.</p>

<p>We’re working on a large scale React application, and in order to aid debugging errors during development, we want to always log errors to the console in the development environment. Well, with the configuration mechanism we just added, it becomes trivially easy to add this default behavior. Just open up your <code>index.ts</code> app entrypoint and add the handler:<br>
</p>

<figure><div class="highlight js-code-highlight">
<pre class="highlight typescript"><code><span class="c1">// index.ts</span>

<span class="nx">EnvironmentUtils</span><span class="p">.</span><span class="nx">runIfDevelopment</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">Do</span><span class="p">.</span><span class="nx">configure</span><span class="p">({</span>
    <span class="na">defaultErrorHandler</span><span class="p">:</span> <span class="p">(</span><span class="nx">result</span><span class="p">?:</span> <span class="nx">ResultRecord</span><span class="o">&lt;</span><span class="kr">any</span><span class="o">&gt;</span><span class="p">,</span> <span class="nx">error</span><span class="p">?:</span> <span class="kr">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
      <span class="nx">error</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre>
<div class="highlight__panel js-actions-panel">
<div class="highlight__panel-action js-fullscreen-code-action">
    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-on"><title>Enter fullscreen mode</title>
    <path d="M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z"></path>
</svg>

    <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" viewbox="0 0 24 24" class="highlight-action crayons-icon highlight-action--fullscreen-off"><title>Exit fullscreen mode</title>
    <path d="M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z"></path>
</svg>

</div>
</div>
</div>
<figcaption>Log errors to the console by default.</figcaption></figure>





<p>You could use the same configuration mechanism to add default behavior to the <code>try</code> or <code>finally</code> portions of the call chain as well. Feel free to peruse the full implementation used in production <a href="https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core/blob/main/src/utilities/do-try.ts">here</a>.</p>

<p>The syntax is quite nice to read and easy to understand at a glace, but with the added bonus of having strongly typed errors, and optional default behavior.</p>

<p>What do you think? Are you going to try “maybe monads” or the <code>Do.try</code> pattern in your next TypeScript project?</p>

</div><div class="bp3-divider _slug__blogPost__body__separator__aFLTG"></div><span class="bp3-tag _slug__blogPost__body__metatag__22QMG"><span icon="calendar" class="bp3-icon bp3-icon-calendar"><svg data-icon="calendar" width="16" height="16" viewBox="0 0 16 16"><desc>calendar</desc><path d="M11 3c.6 0 1-.5 1-1V1c0-.6-.4-1-1-1s-1 .4-1 1v1c0 .5.4 1 1 1zm3-2h-1v1c0 1.1-.9 2-2 2s-2-.9-2-2V1H6v1c0 1.1-.9 2-2 2s-2-.9-2-2V1H1c-.6 0-1 .5-1 1v12c0 .6.4 1 1 1h13c.6 0 1-.4 1-1V2c0-.6-.5-1-1-1zM5 13H2v-3h3v3zm0-4H2V6h3v3zm4 4H6v-3h3v3zm0-4H6V6h3v3zm4 4h-3v-3h3v3zm0-4h-3V6h3v3zM4 3c.6 0 1-.5 1-1V1c0-.6-.4-1-1-1S3 .4 3 1v1c0 .5.4 1 1 1z" fill-rule="evenodd"></path></svg></span><span class="bp3-text-overflow-ellipsis bp3-fill">Jan 16</span></span><a class="_slug__blogPost__body__metatag__22QMG" href="https://dev.to/matjones/strongly-typed-error-handling-in-typescript-2m49" target="_blank" rel="noopener noreferrer"><span class="bp3-tag"><span icon="comment" class="bp3-icon bp3-icon-comment"><svg data-icon="comment" width="16" height="16" viewBox="0 0 16 16"><desc>comment</desc><path d="M14 1H1c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h2v3a1.003 1.003 0 001.71.71L8.41 12H14c.55 0 1-.45 1-1V2c0-.55-.45-1-1-1zM3.5 8C2.67 8 2 7.33 2 6.5S2.67 5 3.5 5 5 5.67 5 6.5 4.33 8 3.5 8zm4 0C6.67 8 6 7.33 6 6.5S6.67 5 7.5 5 9 5.67 9 6.5 8.33 8 7.5 8zm4 0c-.83 0-1.5-.67-1.5-1.5S10.67 5 11.5 5s1.5.67 1.5 1.5S12.33 8 11.5 8z" fill-rule="evenodd"></path></svg></span><span class="bp3-text-overflow-ellipsis bp3-fill">0</span></span></a><a class="_slug__blogPost__body__metatag__22QMG" href="https://dev.to/matjones/strongly-typed-error-handling-in-typescript-2m49" target="_blank" rel="noopener noreferrer"><span class="bp3-tag"><span icon="thumbs-up" class="bp3-icon bp3-icon-thumbs-up"><svg data-icon="thumbs-up" width="16" height="16" viewBox="0 0 16 16"><desc>thumbs-up</desc><path d="M15.99 9.62c-.08-.58-.73-.96-1.43-1.05-.15-.02-.32-.04-.49-.05.06-.01.11-.01.16-.02.71-.08 1.23-.47 1.15-1.05-.08-.58-.73-.96-1.43-1.05-.34-.04-.72-.07-1.13-.09h-.01c-.24-.01-.49-.02-.75-.02-.48-.02-1.11-.04-1.59-.08-.36-.03-.41-.28-.37-.53.35-.9.54-1.91.5-2.91-.04-.85-.6-1.68-1.41-1.77-.67-.07-1.16.39-.99.98C8.76 3.91 6.13 6.2 4 7.49v6c1.66 1.03 4.35 1.56 7.48 1.5.19 0 .39-.01.62-.02h.09c.22-.01.46-.03.73-.05.71-.06 1.54-.51 1.5-1.09-.03-.51-.4-.79-.87-.93.27-.02.54-.04.79-.06.71-.06 1.24-.45 1.17-1.04-.06-.58-.7-.97-1.41-1.07-.02 0-.05-.01-.07-.01.29-.02.57-.03.81-.05.71-.03 1.23-.47 1.15-1.05zM2 7H0v7h2c.55 0 1-.45 1-1V8c0-.56-.45-1-1-1z" fill-rule="evenodd"></path></svg></span><span class="bp3-text-overflow-ellipsis bp3-fill">1</span></span></a></div></div></div><div class="bp3-navbar app-footer_appFooter__41J6R"><div class="app-footer_appFooter__content__hroa8"><p>© <!-- -->2021<!-- --> M. Jones Software Systems, LLC.</p><p>Last build: <!-- -->January 22, 2021 at 8:28 AM EST</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"type_of":"article","id":573392,"title":"Strongly Typed Error Handling in TypeScript","description":"TypeScript is a great language. TypeScript takes JavaScript and makes it actually good. If there’s on...","readable_publish_date":"Jan 16","slug":"strongly-typed-error-handling-in-typescript-2m49","path":"/matjones/strongly-typed-error-handling-in-typescript-2m49","url":"https://dev.to/matjones/strongly-typed-error-handling-in-typescript-2m49","comments_count":0,"public_reactions_count":1,"collection_id":null,"published_timestamp":"2021-01-16T14:42:46Z","positive_reactions_count":1,"cover_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--iaDSv-7K--/c_imagga_scale,f_auto,fl_progressive,h_420,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/i/fi12u6nldkfm4kesn07z.png","social_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--gIZ3ch1n--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://dev-to-uploads.s3.amazonaws.com/i/fi12u6nldkfm4kesn07z.png","canonical_url":"https://dev.to/matjones/strongly-typed-error-handling-in-typescript-2m49","created_at":"2021-01-16T14:42:46Z","edited_at":"2021-01-18T18:23:49Z","crossposted_at":null,"published_at":"2021-01-16T14:42:46Z","last_comment_at":"2021-01-16T14:42:46Z","tag_list":"typescript, javascript, design, programming","tags":["typescript","javascript","design","programming"],"body_html":"\u003cp\u003eTypeScript is a great language. TypeScript takes JavaScript and makes it \u003cem\u003eactually good.\u003c/em\u003e If there’s one glaring weakness, it’s the \u003ca href=\"https://github.com/Microsoft/TypeScript/issues/8677\"\u003einability to use strongly typed catch blocks\u003c/a\u003e. However, this is mostly due to a design flaw in the JavaScript language; in JavaScript, you can \u003ccode\u003ethrow\u003c/code\u003e \u003cem\u003eanything\u003c/em\u003e, not just \u003ccode\u003eError\u003c/code\u003e types.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"a-note-before-we-start\" href=\"#a-note-before-we-start\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  A Note Before We Start\n\u003c/h1\u003e\n\n\u003cp\u003eWhile I used some packages from the \u003ccode\u003eAndcultureCode\u003c/code\u003e GitHub organization, it just made this proof-of-concept easier to demonstrate. This same pattern could be easily applied without using any of these packages, and could be tied in with whatever existing infrastructure you have set up.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"justification\" href=\"#justification\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Justification\n\u003c/h1\u003e\n\n\u003cp\u003eConsider the following, completely valid TypeScript code:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"na\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003enumber\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \"number\"\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 7\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eYou can quite literally throw anything.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eIt’s easy to see why this can be a problem.  One use-case where this is less than ideal is consuming a web API from TypeScript. It’s quite common for non-success HTTP status codes (500 Internal Server Error, 404 Not Found, etc.) to be thrown as an error by API consumer code.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"usage\" href=\"#usage\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Usage\n\u003c/h1\u003e\n\n\u003cp\u003eLet’s consider an example using some utilities from \u003ca href=\"https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core\"\u003eAndcultureCode.JavaScript.Core\u003c/a\u003e and \u003ca href=\"https://github.com/AndcultureCode/AndcultureCode.JavaScript.React\"\u003eAndcultureCode.JavaScript.React\u003c/a\u003e, which wrap up API responses and errors in \u003ccode\u003eResultRecord\u003c/code\u003e and \u003ccode\u003eResultErrorRecord\u003c/code\u003e \u003ca href=\"https://github.com/immutable-js/immutable-js\"\u003eImmutable.js\u003c/a\u003e \u003ccode\u003eRecord\u003c/code\u003e types.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/*\nLet's say the API returns a 500 error, with an error\nresult JSON object:\n-- Status: 500\n-- Data:\n{\n  \"errors\": [\n    {\n      \"key\": \"UserAlreadyExists\",\n      \"message\": \"User with specified email already exists.\",\n      \"type\": \"Validation\"\n    }\n  ]\n  \"resultObject\": undefined\n}\n*/\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserApi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eServiceFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/api/users/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserApi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresultObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// if the thing that was thrown is a ResultRecord, show a toast message for each error\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"k\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"na\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultErrorRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003etoast\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// otherwise, it could be anything, so just show a generic error message\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etoast\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eThere was an issue creating the user.\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efinally\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// maybe we need to turn off a loading indicator here\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eYou can see in this example that handling errors natively in TypeScript is… quite sloppy. The \u003ca href=\"https://en.wikipedia.org/wiki/Monad_%28functional_programming%29#An_example:_Maybe\"\u003e“maybe monad”\u003c/a\u003e common pattern to more generically handle errors and control flow. Basically, what we want to do is create an abstraction that can strongly type thrown errors to a specified type that you know is likely to be thrown. In our case, we want to be able to handle errors from a strongly typed \u003ccode\u003eResultRecord\u003c/code\u003e with \u003ccode\u003eResultErrorRecord\u003c/code\u003es inside it.\u003c/p\u003e\n\n\u003cp\u003eWhat if we could take the example above, and represent the same logic but with less code and strong typing in the catch block? In the following example, one of \u003ccode\u003eresult\u003c/code\u003e or \u003ccode\u003eerror\u003c/code\u003e will be non-null, but not both.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/*\nLet's say the API returns the same response as before.\nresult JSON object:\n-- Status: 500\n-- Data:\n{\n  \"errors\": [\n    {\n      \"key\": \"UserAlreadyExists\",\n      \"message\": \"User with specified email already exists.\",\n      \"type\": \"Validation\"\n    }\n  ]\n  \"resultObject\": undefined\n}\n*/\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserApi\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eServiceFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/api/users/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserApi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresultObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// if result is not null, it will have errors; show toast errors\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"na\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultErrorRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003etoast\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// otherwise, unknown error; show a generic toast message\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003etoast\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eThere was an issue creating the user.\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003efinally\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// maybe we need to turn off a loading indicator here\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003egetAwaiter\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eAutomatic typecasting? Nice 😎\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eThis pattern gives us a more functional approach to error handling, gives us \u003cstrong\u003estrongly typed\u003c/strong\u003e errors, and works really, really nicely when used in combination with \u003ca href=\"https://reactjs.org/docs/hooks-intro.html\"\u003eReact hooks\u003c/a\u003e. Let’s take a look at a simple React example using some infrastructure from \u003ca href=\"https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core\"\u003eAndcultureCode.JavaScript.Core\u003c/a\u003e, \u003ca href=\"https://github.com/AndcultureCode/AndcultureCode.JavaScript.React\"\u003eAndcultureCode.JavaScript.React\u003c/a\u003e and \u003ca href=\"https://github.com/AndcultureCode/AndcultureCode.JavaScript.React.Components\"\u003eAndcultureCode.JavaScript.React.Components\u003c/a\u003e:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eLoginForm\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eReact\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eFunctionComponent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ecreate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserApi\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003euseCreate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseHistory\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetUser\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetErrors\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eArray\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eResultErrorRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e([]);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eloading\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetLoading\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUser\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseCallback\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003esetErrors\u003c/span\u003e\u003cspan class=\"p\"\u003e([]);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003esetLoading\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateUserApi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003ehistory\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eRouteUtils\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUrl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esiteMap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emyProfile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003euserId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresultObject\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eUserRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003esetErrors\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e \u003cspan class=\"o\"\u003e??\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003etoast\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eThere was an issue signing up.\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"k\"\u003efinally\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esetLoading\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetAwaiter\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateUserApi\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ediv\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ec-login-form\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eInputFormField\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003edisabled\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eloading\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003elabel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eEmail\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erequired\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eInputTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEmail\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eonChange\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esetUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003eemail\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e})}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eSignUp.Email\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\n      \u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eInputFormField\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003edisabled\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eloading\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003elabel\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ePassword\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erequired\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eInputTypes\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ePassword\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eonChange\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esetUser\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003ewith\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003epassword\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e})}\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eerrors\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eSignUp.Password\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\n      \u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eButton\u003c/span\u003e \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateUser\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSign\u003c/span\u003e \u003cspan class=\"nx\"\u003eUp\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/Button\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eloading\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eLoadingSpinner\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/div\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eStrong typing is better than weak typing.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eClean, concise, and strongly typed error handling in just 46 lines of code, including the UI.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"implementation\" href=\"#implementation\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Implementation\n\u003c/h1\u003e\n\n\u003cp\u003eSo how does this fancy-schmancy \u003ccode\u003eDo.try\u003c/code\u003e work under the hood? By adding an abstraction on top of regular old \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise\"\u003ePromise\u003c/a\u003es. Let’s break it down.\u003c/p\u003e\n\n\u003cp\u003eFirst, let’s define some utility types we’re going to need:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"cm\"\u003e/**\n * Represents an asynchronous method reference.\n */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eAsyncWorkload\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * Handler for a typed error ResultRecord, or any type if a Javascript error occurred.\n */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eCatchResultHandler\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * Handler for Do.try().finally(); Runs whether an error occurred or not.\n */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eFinallyHandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eStrongly typed handlers for strongly typed errors.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eNext, let’s take a look at our constructor:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"na\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eworkload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eAsyncWorkload\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epromise\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eworkload\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003ePrivate constructor? 🤔\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eThat \u003ccode\u003eprivate constructor\u003c/code\u003e is no mistake. You’ll notice in the previous snippets, usage of this pattern starts with \u003ccode\u003eDo.try\u003c/code\u003e; that’s because \u003ccode\u003etry\u003c/code\u003e is a static factory method that returns an instance of \u003ccode\u003eDo\u003c/code\u003e. The \u003ccode\u003eprivate constructor\u003c/code\u003e can only be called internally to the class, by the \u003ccode\u003etry\u003c/code\u003e method. The implementation of \u003ccode\u003etry\u003c/code\u003e is very straightforward:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e...\u003c/span\u003e \n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eworkload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eAsyncWorkload\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eworkload\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eYou’ll never know unless you… try.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eThe \u003ccode\u003efinally\u003c/code\u003e method is just as straightforward, with one important caveat:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003efinally\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"na\"\u003efinallyHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFinallyHandler\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epromise\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003efinally\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efinallyHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003ePay special attention to the return value.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eNotice the return value, \u003ccode\u003ereturn this;\u003c/code\u003e This allows for method chaining, i.e. \u003ccode\u003eDo.try(workload).catch(catchHandler).finally(finallyHandler);\u003c/code\u003e In this code, \u003ccode\u003ecatch\u003c/code\u003e and \u003ccode\u003efinally\u003c/code\u003e are both called on the same instance of \u003ccode\u003eDo\u003c/code\u003e which is returned from \u003ccode\u003eDo.try\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThere’s also a \u003ccode\u003egetAwaiter\u003c/code\u003e method, which allows us to \u003ccode\u003eawait\u003c/code\u003e for the result. All we need to do is return the internal promise.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003egetAwaiter\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eThis just allows us to await the result of the entire method chain.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eNow let’s get to the interesting part; the \u003ccode\u003ecatch\u003c/code\u003e method. Inside the catch method, we’re going to \u003ca href=\"https://www.typescriptlang.org/docs/handbook/advanced-types.html#user-defined-type-guards\"\u003etype guard\u003c/a\u003e the thrown object; if the thrown object is a \u003ccode\u003eResultRecord\u003c/code\u003e instance, we cast it as such and pass it as the catch handler’s first argument; otherwise, it’s some unknown error, so we pass it as the catch handler’s second argument. We also need to cast the promise back to a \u003ccode\u003ePromise\u0026lt;TReturnVal\u0026gt;\u003c/code\u003e because of the return type of \u003ccode\u003ePromise.catch\u003c/code\u003e, but the promise is still a valid \u003ccode\u003ePromise\u0026lt;TReturnVal\u0026gt;\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eerrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eCatchResultHandler\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epromise\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epromise\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"na\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// check if thrown object is a ResultRecord\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"k\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e// pass the ResultRecord as the first parameter\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eerrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"c1\"\u003e// otherwise, pass the generic error as the second parameter\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eerrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// notice again, we are returning this to allow method chaining\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eWe just need to cast the promise back to a `Promise` because of the return type of `Promise.catch`, but rest assured, the promise is still a valid `Promise`.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eAnd there you have a basic implementation of a “maybe monad”. While the implementation here is an opinionated one, offering strongly typed error handling for \u003ccode\u003eResultRecord\u003c/code\u003e errors, you could easily implement the same thing for virtually any type you want to use to wrap up your errors, just as long as you’re able to implement a type guard for it.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"taking-it-further\" href=\"#taking-it-further\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Taking It Further\n\u003c/h1\u003e\n\n\u003cp\u003eI think strongly typed error handling speaks enough for itself, but we can take it even further. This pattern enables an extremely powerful utility, and I think it’s the strongest argument for using it: \u003ca href=\"https://en.wikipedia.org/wiki/Default_(computer_science)#In_application_software\"\u003e\u003cem\u003edefault behavior\u003c/em\u003e\u003c/a\u003e. We can extend our \u003ccode\u003eDo\u003c/code\u003e class to have a global configuration, allowing us to define \u003cem\u003edefault behavior which is applied to every instance of \u003ccode\u003eDo\u003c/code\u003e across the entire application\u003c/em\u003e.\u003c/p\u003e\n\n\u003cp\u003eAll we need to do is add a static configuration mechanism, and implement a check for our configuration inside the constructor:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eDoTryConfig\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/**\n   * A default handler that will always run on error, if configured,\n   * even if a `catch()` does not exist in the call chain.\n   * This is useful for adding default error handling in the\n   * development environment, such as `console.error(err)`.\n   */\u003c/span\u003e\n  \u003cspan class=\"nl\"\u003edefaultErrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003eCatchResultHandler\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTResourceType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDoTryConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edefaultErrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eworkload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eAsyncWorkload\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTReturnVal\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epromise\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eworkload\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"na\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"c1\"\u003e// check for defaultErrorHandler from config\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"k\"\u003einstanceof\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultRecord\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edefaultErrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e?.(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// rethrow so it doesn't interrupt call chain\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n      \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edefaultErrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e?.(\u003c/span\u003e\u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// rethrow so it doesn't interrupt call chain\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"cm\"\u003e/**\n   * Sets the global configuration object for class {Do}\n   * @param config the {DoTryConfig} object to set\n   */\u003c/span\u003e\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003econfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDoTryConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eDefault behavior is epic.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eSo what does it look like to apply default behavior? Let’s contrive an example.\u003c/p\u003e\n\n\u003cp\u003eWe’re working on a large scale React application, and in order to aid debugging errors during development, we want to always log errors to the console in the development environment. Well, with the configuration mechanism we just added, it becomes trivially easy to add this default behavior. Just open up your \u003ccode\u003eindex.ts\u003c/code\u003e app entrypoint and add the handler:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cfigure\u003e\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// index.ts\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eEnvironmentUtils\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erunIfDevelopment\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003econfigure\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edefaultErrorHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003eResultRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eerror\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cfigcaption\u003eLog errors to the console by default.\u003c/figcaption\u003e\u003c/figure\u003e\n\n\n\n\n\n\u003cp\u003eYou could use the same configuration mechanism to add default behavior to the \u003ccode\u003etry\u003c/code\u003e or \u003ccode\u003efinally\u003c/code\u003e portions of the call chain as well. Feel free to peruse the full implementation used in production \u003ca href=\"https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core/blob/main/src/utilities/do-try.ts\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe syntax is quite nice to read and easy to understand at a glace, but with the added bonus of having strongly typed errors, and optional default behavior.\u003c/p\u003e\n\n\u003cp\u003eWhat do you think? Are you going to try “maybe monads” or the \u003ccode\u003eDo.try\u003c/code\u003e pattern in your next TypeScript project?\u003c/p\u003e\n\n","body_markdown":"TypeScript is a great language. TypeScript takes JavaScript and makes it _actually good._ If there’s one glaring weakness, it’s the [inability to use strongly typed catch blocks](https://github.com/Microsoft/TypeScript/issues/8677). However, this is mostly due to a design flaw in the JavaScript language; in JavaScript, you can `throw` _anything_, not just `Error` types.\n\nA Note Before We Start\n======================\n\nWhile I used some packages from the `AndcultureCode` GitHub organization, it just made this proof-of-concept easier to demonstrate. This same pattern could be easily applied without using any of these packages, and could be tied in with whatever existing infrastructure you have set up.\n\nJustification\n=============\n\nConsider the following, completely valid TypeScript code:\n```ts\ntry {\n  const x: number = 7;\n  throw x;\n} catch (e) {\n  console.log(typeof e); // \"number\"\n  console.log(e); // 7\n}\n```\n\u003cfigcaption\u003eYou can quite literally throw anything.\u003c/figcaption\u003e\n\nIt’s easy to see why this can be a problem.  One use-case where this is less than ideal is consuming a web API from TypeScript. It’s quite common for non-success HTTP status codes (500 Internal Server Error, 404 Not Found, etc.) to be thrown as an error by API consumer code.\n\nUsage\n=====\n\nLet’s consider an example using some utilities from [AndcultureCode.JavaScript.Core](https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core) and [AndcultureCode.JavaScript.React](https://github.com/AndcultureCode/AndcultureCode.JavaScript.React), which wrap up API responses and errors in `ResultRecord` and `ResultErrorRecord` [Immutable.js](https://github.com/immutable-js/immutable-js) `Record` types.\n\n```ts\n/*\nLet's say the API returns a 500 error, with an error\nresult JSON object:\n-- Status: 500\n-- Data:\n{\n  \"errors\": [\n    {\n      \"key\": \"UserAlreadyExists\",\n      \"message\": \"User with specified email already exists.\",\n      \"type\": \"Validation\"\n    }\n  ]\n  \"resultObject\": undefined\n}\n*/\n\nconst createUserApi = ServiceFactory.create(UserRecord, \"/api/users/\");\n\nconst createUser = async (user: UserRecord): Promise\u003cUserRecord | undefined\u003e =\u003e {\n  try {\n    const result = await createUserApi(user);\n    return result.resultObject;\n  } catch (e) {\n    // if the thing that was thrown is a ResultRecord, show a toast message for each error\n    if (e instanceof ResultRecord) {\n      e.errors.forEach((error: ResultErrorRecord) =\u003e toast.error(error.message));\n      return undefined.\n    }\n  \n    // otherwise, it could be anything, so just show a generic error message\n    toast.error(\"There was an issue creating the user.\");\n    return undefined;\n  } finally {\n    // maybe we need to turn off a loading indicator here\n  }\n};\n```\n\nYou can see in this example that handling errors natively in TypeScript is… quite sloppy. The [“maybe monad”](https://en.wikipedia.org/wiki/Monad_%28functional_programming%29#An_example:_Maybe) common pattern to more generically handle errors and control flow. Basically, what we want to do is create an abstraction that can strongly type thrown errors to a specified type that you know is likely to be thrown. In our case, we want to be able to handle errors from a strongly typed `ResultRecord` with `ResultErrorRecord`s inside it.\n\nWhat if we could take the example above, and represent the same logic but with less code and strong typing in the catch block? In the following example, one of `result` or `error` will be non-null, but not both.\n\n```ts\n/*\nLet's say the API returns the same response as before.\nresult JSON object:\n-- Status: 500\n-- Data:\n{\n  \"errors\": [\n    {\n      \"key\": \"UserAlreadyExists\",\n      \"message\": \"User with specified email already exists.\",\n      \"type\": \"Validation\"\n    }\n  ]\n  \"resultObject\": undefined\n}\n*/\n\nconst createUserApi = ServiceFactory.create(UserRecord, \"/api/users/\");\n\nconst createUser = async (user: UserRecord): Promise\u003cUserRecord | undefined\u003e =\u003e\n  await Do.try(async () =\u003e {\n    const result = await createUserApi(user);\n    return result.resultObject;\n  }).catch((result?: ResultRecord\u003cUserRecord\u003e, error?: any) =\u003e {\n    // if result is not null, it will have errors; show toast errors\n    result?.errors?.forEach((e: ResultErrorRecord) =\u003e toast.error(e.message));\n    // otherwise, unknown error; show a generic toast message\n    error != null \u0026\u0026 toast.error(\"There was an issue creating the user.\");\n  }).finally(() =\u003e {\n    // maybe we need to turn off a loading indicator here\n  }).getAwaiter();\n```\n\u003cfigcaption\u003eAutomatic typecasting? Nice 😎\u003c/figcaption\u003e\n\nThis pattern gives us a more functional approach to error handling, gives us **strongly typed** errors, and works really, really nicely when used in combination with [React hooks](https://reactjs.org/docs/hooks-intro.html). Let’s take a look at a simple React example using some infrastructure from [AndcultureCode.JavaScript.Core](https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core), [AndcultureCode.JavaScript.React](https://github.com/AndcultureCode/AndcultureCode.JavaScript.React) and [AndcultureCode.JavaScript.React.Components](https://github.com/AndcultureCode/AndcultureCode.JavaScript.React.Components):\n\n```ts\nconst LoginForm: React.FunctionComponent = () =\u003e {\n  const { create: createUserApi } = UserService.useCreate();\n  const history = useHistory();\n  const [user, setUser] = useState(new UserRecord());\n  const [errors, setErrors] = useState\u003cArray\u003cResultErrorRecord\u003e\u003e([]);\n  const [loading, setLoading] = useState(false);\n\n  const createUser = useCallback(\n    async () =\u003e await Do.try(async () =\u003e {\n      setErrors([]);\n      setLoading(true);\n      const result = await createUserApi(user);\n      history.push(RouteUtils.getUrl(siteMap.myProfile, { userId: result.resultObject!.id! }));\n    }).catch((result?: ResultRecord\u003cUserRecord\u003e, error?: any) =\u003e {\n      setErrors(result?.errors ?? []);\n      error != null \u0026\u0026 toast.error(\"There was an issue signing up.\");\n    }).finally(() =\u003e setLoading(false))\n      .getAwaiter(),\n    [createUserApi, user]\n  );\n\n  return (\n    \u003cdiv className=\"c-login-form\"\u003e\n      \u003cInputFormField\n        disabled={loading}\n        label=\"Email\"\n        required={true}\n        type={InputTypes.Email}\n        value={user.email}\n        onChange={e =\u003e setUser(user.with({ email: e.target.value })}\n        errors={errors.filter(e =\u003e e.key === \"SignUp.Email\")}\n      /\u003e\n      \u003cInputFormField\n        disabled={loading}\n        label=\"Password\"\n        required={true}\n        type={InputTypes.Password}\n        value={user.password}\n        onChange={e =\u003e setUser(user.with({ password: e.target.value })}\n        errors={errors.filter(e =\u003e e.key === \"SignUp.Password\")}\n      /\u003e\n      \u003cButton onClick={createUser}\u003eSign Up\u003c/Button\u003e\n      {loading \u0026\u0026 (\u003cLoadingSpinner/\u003e)}\n    \u003c/div\u003e\n  );\n};\n```\n\u003cfigcaption\u003eStrong typing is better than weak typing.\u003c/figcaption\u003e\n\nClean, concise, and strongly typed error handling in just 46 lines of code, including the UI.\n\nImplementation\n==============\n\nSo how does this fancy-schmancy `Do.try` work under the hood? By adding an abstraction on top of regular old [Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)s. Let’s break it down.\n\nFirst, let’s define some utility types we’re going to need:\n\n```ts\n/**\n * Represents an asynchronous method reference.\n */\ntype AsyncWorkload\u003cT\u003e = () =\u003e Promise\u003cT\u003e;\n\n/**\n * Handler for a typed error ResultRecord, or any type if a Javascript error occurred.\n */\ntype CatchResultHandler\u003cT\u003e = (result?: ResultRecord\u003cT\u003e, error?: any) =\u003e void;\n\n/**\n * Handler for Do.try().finally(); Runs whether an error occurred or not.\n */\ntype FinallyHandler = () =\u003e void;\n```\n\u003cfigcaption\u003eStrongly typed handlers for strongly typed errors.\u003c/figcaption\u003e\n\nNext, let’s take a look at our constructor:\n\n```ts\nclass Do\u003cTResourceType, TReturnVal = void\u003e {\n  private promise: Promise\u003cTReturnVal\u003e;\n  \n  private constructor(workload: AsyncWorkload\u003cTReturnVal\u003e) {\n    this.promise = workload();\n  }\n}\n```\n\u003cfigcaption\u003ePrivate constructor? 🤔\u003c/figcaption\u003e\n\nThat `private constructor` is no mistake. You’ll notice in the previous snippets, usage of this pattern starts with `Do.try`; that’s because `try` is a static factory method that returns an instance of `Do`. The `private constructor` can only be called internally to the class, by the `try` method. The implementation of `try` is very straightforward:\n\n```ts\nclass Do\u003cTResourceType, TReturnVal = void\u003e {\n  ... \n  public static try\u003cTResourceType, TReturnVal = void\u003e(\n    workload: AsyncWorkload\u003cTReturnVal\u003e\n  ): Do\u003cTResourceType, TReturnVal\u003e {\n    return new Do\u003cTResourceType, TReturnVal\u003e(workload);\n  }\n}\n```\n\u003cfigcaption\u003eYou’ll never know unless you… try.\u003c/figcaption\u003e\n\nThe `finally` method is just as straightforward, with one important caveat:\n\n```ts\nclass Do\u003cTResourceType, TReturnVal = void\u003e {\n  ...\n  public finally(\n    finallyHandler: FinallyHandler\n  ): Do\u003cTResourceType, TReturnVal\u003e {\n    this.promise = this.promise.finally(finallyHandler);\n    return this;\n  }\n}\n```\n\u003cfigcaption\u003ePay special attention to the return value.\u003c/figcaption\u003e\n\nNotice the return value, `return this;` This allows for method chaining, i.e. `Do.try(workload).catch(catchHandler).finally(finallyHandler);` In this code, `catch` and `finally` are both called on the same instance of `Do` which is returned from `Do.try`.\n\nThere’s also a `getAwaiter` method, which allows us to `await` for the result. All we need to do is return the internal promise.\n\n```ts\nclass Do\u003cTResourceType, TReturnVal = void\u003e {\n  ...\n  public async getAwaiter(): Promise\u003cTReturnVal\u003e {\n    return this.promise;\n  }\n}\n```\n\u003cfigcaption\u003eThis just allows us to await the result of the entire method chain.\u003c/figcaption\u003e\n\nNow let’s get to the interesting part; the `catch` method. Inside the catch method, we’re going to [type guard](https://www.typescriptlang.org/docs/handbook/advanced-types.html#user-defined-type-guards) the thrown object; if the thrown object is a `ResultRecord` instance, we cast it as such and pass it as the catch handler’s first argument; otherwise, it’s some unknown error, so we pass it as the catch handler’s second argument. We also need to cast the promise back to a `Promise\u003cTReturnVal\u003e` because of the return type of `Promise.catch`, but the promise is still a valid `Promise\u003cTReturnVal\u003e`.\n\n```ts\nclass Do\u003cTResourceType, TReturnVal = void\u003e {\n  public catch(\n    errorHandler: CatchResultHandler\u003cTResourceType\u003e\n  ): Do\u003cTResourceType, TReturnVal\u003e {\n    this.promise = this.promise.catch((err: any) =\u003e {\n      // check if thrown object is a ResultRecord\n      if (err instanceof ResultRecord) {\n        // pass the ResultRecord as the first parameter\n        errorHandler(err, undefined);\n        return;\n      }\n      \n      // otherwise, pass the generic error as the second parameter\n      errorHandler(undefined, err);\n    }) as Promise\u003cTReturnVal\u003e;\n    \n    // notice again, we are returning this to allow method chaining\n    return this;\n  }\n}\n```\n\u003cfigcaption\u003eWe just need to cast the promise back to a `Promise\u003cTReturnVal\u003e` because of the return type of `Promise.catch`, but rest assured, the promise is still a valid `Promise\u003cTReturnVal\u003e`.\u003c/figcaption\u003e\n\nAnd there you have a basic implementation of a “maybe monad”. While the implementation here is an opinionated one, offering strongly typed error handling for `ResultRecord` errors, you could easily implement the same thing for virtually any type you want to use to wrap up your errors, just as long as you’re able to implement a type guard for it.\n\nTaking It Further\n=================\n\nI think strongly typed error handling speaks enough for itself, but we can take it even further. This pattern enables an extremely powerful utility, and I think it’s the strongest argument for using it: [_default behavior_](https://en.wikipedia.org/wiki/Default_(computer_science)#In_application_software). We can extend our `Do` class to have a global configuration, allowing us to define _default behavior which is applied to every instance of `Do` across the entire application_.\n\nAll we need to do is add a static configuration mechanism, and implement a check for our configuration inside the constructor:\n\n```ts\ninterface DoTryConfig {\n  /**\n   * A default handler that will always run on error, if configured,\n   * even if a `catch()` does not exist in the call chain.\n   * This is useful for adding default error handling in the\n   * development environment, such as `console.error(err)`.\n   */\n  defaultErrorHandler?: CatchResultHandler\u003cany\u003e;\n}\n\nclass Do\u003cTResourceType, TReturnVal = void\u003e {\n  ...\n  private static config: DoTryConfig = {\n    defaultErrorHandler: undefined,\n  };\n  \n  private constructor(workload: AsyncWorkload\u003cTReturnVal\u003e) {\n    this.promise = workload().catch((err: any) =\u003e {\n      // check for defaultErrorHandler from config\n      if (err instanceof ResultRecord) {\n        Do.config.defaultErrorHandler?.(err, undefined);\n        throw err; // rethrow so it doesn't interrupt call chain\n      }\n\n      Do.config.defaultErrorHandler?.(undefined, err);\n      throw err; // rethrow so it doesn't interrupt call chain\n    });\n  }\n  \n  /**\n   * Sets the global configuration object for class {Do}\n   * @param config the {DoTryConfig} object to set\n   */\n  public static configure(config: DoTryConfig): void {\n    Do.config = config;\n  }\n}\n```\n\u003cfigcaption\u003eDefault behavior is epic.\u003c/figcaption\u003e\n\nSo what does it look like to apply default behavior? Let’s contrive an example.\n\nWe’re working on a large scale React application, and in order to aid debugging errors during development, we want to always log errors to the console in the development environment. Well, with the configuration mechanism we just added, it becomes trivially easy to add this default behavior. Just open up your `index.ts` app entrypoint and add the handler:\n\n```ts\n// index.ts\n\nEnvironmentUtils.runIfDevelopment(() =\u003e {\n  Do.configure({\n    defaultErrorHandler: (result?: ResultRecord\u003cany\u003e, error?: any) =\u003e {\n      result != null \u0026\u0026 console.error(result);\n      error != null \u0026\u0026 console.error(error);\n    }\n  });\n});\n```\n\u003cfigcaption\u003eLog errors to the console by default.\u003c/figcaption\u003e\n\nYou could use the same configuration mechanism to add default behavior to the `try` or `finally` portions of the call chain as well. Feel free to peruse the full implementation used in production [here](https://github.com/AndcultureCode/AndcultureCode.JavaScript.Core/blob/main/src/utilities/do-try.ts).\n\nThe syntax is quite nice to read and easy to understand at a glace, but with the added bonus of having strongly typed errors, and optional default behavior.\n\nWhat do you think? Are you going to try “maybe monads” or the `Do.try` pattern in your next TypeScript project?\n","user":{"name":"Mat Jones","username":"matjones","twitter_username":null,"github_username":"mrjones2014","website_url":"https://mjones.network","profile_image":"https://res.cloudinary.com/practicaldev/image/fetch/s--rzQaKEWl--/c_fill,f_auto,fl_progressive,h_640,q_auto,w_640/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/561062/dde6a19b-1df3-4ed3-b723-86424694d93f.png","profile_image_90":"https://res.cloudinary.com/practicaldev/image/fetch/s--lIbHS3Lt--/c_fill,f_auto,fl_progressive,h_90,q_auto,w_90/https://dev-to-uploads.s3.amazonaws.com/uploads/user/profile_image/561062/dde6a19b-1df3-4ed3-b723-86424694d93f.png"}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"strongly-typed-error-handling-in-typescript-2m49"},"buildId":"M47dHq_1yx67gPPyUnMEs","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-246c4c8f803edec18188.js"></script><script src="/_next/static/chunks/main-eec4aa9cad9b01b10bdb.js" async=""></script><script src="/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/_next/static/chunks/framework.17593bdcc9786a05bc11.js" async=""></script><script src="/_next/static/chunks/6278397b.345c06e4e71201848f4a.js" async=""></script><script src="/_next/static/chunks/1899967d.bbb99a9033920b4fc3df.js" async=""></script><script src="/_next/static/chunks/e528790cfab2d1a610238dc3edf348c46281d678.f124a28100027cef5782.js" async=""></script><script src="/_next/static/chunks/b54bf8666a19c68ed291d909bca66d7bd261c51d.07576abf9e5bfd60e066.js" async=""></script><script src="/_next/static/chunks/e82d01500e11e0131e78851aa17fd9f5e63d6c88.9721a3d740421889fdc9.js" async=""></script><script src="/_next/static/chunks/pages/_app-227167814087f23f0f50.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-3e965507edcacefbaa18.js" async=""></script><script src="/_next/static/M47dHq_1yx67gPPyUnMEs/_buildManifest.js" async=""></script><script src="/_next/static/M47dHq_1yx67gPPyUnMEs/_ssgManifest.js" async=""></script></body></html>